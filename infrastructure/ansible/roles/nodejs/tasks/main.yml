---
# Role: nodejs â€” Installs Node.js via official NodeSource script

- name: Check if Node.js is already installed
  command: node --version
  register: node_check
  ignore_errors: true
  changed_when: false

- name: Download NodeSource setup script
  get_url:
    url: "https://deb.nodesource.com/setup_{{ nodejs_version }}.x"
    dest: /tmp/nodesource_setup.sh
    mode: "0755"
  when: node_check.failed

- name: Execute NodeSource setup script
  command: bash /tmp/nodesource_setup.sh
  when: node_check.failed

- name: Install Node.js {{ nodejs_version }}.x
  apt:
    name: nodejs
    state: present
    update_cache: yes
  when: node_check.failed

- name: Verify installed version
  command: node --version
  register: node_version
  changed_when: false

- name: Display Node.js version
  debug:
    msg: "Installed Node.js version: {{ node_version.stdout }}"
